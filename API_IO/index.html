
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Early age patents for humans and researchers">
      
      
      
        <meta name="author" content="Cyril Verluise">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.3">
    
    
      
        <title>io - patentCity</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e35208c4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#patentcity.io" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="patentCity" class="md-header__button md-logo" aria-label="patentCity" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            patentCity
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              io
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/cverluise/patentcity/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      About
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../DATA/" class="md-tabs__link">
      Data
    </a>
  </li>

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../DD/" class="md-tabs__link">
        Guides
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../ASSETS_POPULATION/" class="md-tabs__link">
        Assets
      </a>
    </li>
  

  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../API_BREW/" class="md-tabs__link md-tabs__link--active">
        API
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../LICENSE_CODE/" class="md-tabs__link">
        License
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="patentCity" class="md-nav__button md-logo" aria-label="patentCity" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    patentCity
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/cverluise/patentcity/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../DATA/" class="md-nav__link">
        Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Guides
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      <label class="md-nav__link" for="__nav_3_1">
        DD
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DD" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          DD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DD/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DD_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DD_MODEL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        DE
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DE" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          DE
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DE/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DE_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DE_MODEL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      <label class="md-nav__link" for="__nav_3_3">
        FR
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="FR" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          FR
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../FR/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../FR_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../FR_MODEL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      <label class="md-nav__link" for="__nav_3_4">
        GB
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="GB" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          GB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../GB/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../GB_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../GB_MODEL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      <label class="md-nav__link" for="__nav_3_5">
        US
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="US" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          US
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../US/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../US_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../US_MODEL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" >
      
      <label class="md-nav__link" for="__nav_3_6">
        Relationship
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Relationship" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Relationship
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_REL_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_REL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_7" type="checkbox" id="__nav_3_7" >
      
      <label class="md-nav__link" for="__nav_3_7">
        Enrichment
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Enrichment" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Enrichment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DD_DATE_IMPUTATION/" class="md-nav__link">
        DD dates
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DE_DATE_IMPUTATION/" class="md-nav__link">
        DE dates
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_GEOC_REPORT/" class="md-nav__link">
        Geocoding
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_CIT_EVALUATION/" class="md-nav__link">
        Citizenship
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_STATISTICAL_AREAS/" class="md-nav__link">
        Statistical areas
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_DEDUPLICATION_EVALUATION/" class="md-nav__link">
        Deduplication
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_8" type="checkbox" id="__nav_3_8" >
      
      <label class="md-nav__link" for="__nav_3_8">
        Recipes
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Recipes" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Recipes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../RECIPE_PATENTCITY/" class="md-nav__link">
        PatentCity
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../RECIPE_WGP/" class="md-nav__link">
        WGP
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../CHEATSHEET/" class="md-nav__link">
        Cheatsheet
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Assets
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Assets" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Assets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      <label class="md-nav__link" for="__nav_4_1">
        Demography
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Demography" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Demography
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_POPULATION/" class="md-nav__link">
        Population
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_IMMIGRATION/" class="md-nav__link">
        Immigration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_AREA/" class="md-nav__link">
        Area
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      <label class="md-nav__link" for="__nav_4_2">
        Structure
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Structure" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Structure
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_GDPREG/" class="md-nav__link">
        Regional GDP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_GDPSHAREAGRICULTURE/" class="md-nav__link">
        Share agriculture
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_GDPSHAREINDUSTRY/" class="md-nav__link">
        Share industry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_GDPSHARESERVICE/" class="md-nav__link">
        Share service
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      <label class="md-nav__link" for="__nav_4_3">
        Gravity
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Gravity" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Gravity
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_BORDER/" class="md-nav__link">
        Border
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_LANGUAGE/" class="md-nav__link">
        Language
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_DISTANCE/" class="md-nav__link">
        Distance
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_GDPPCCOUNTRY/" class="md-nav__link">
        GDP per capita
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_EXPORTS/" class="md-nav__link">
        Exports
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ASSETS_IMPORTS/" class="md-nav__link">
        Imports
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      <label class="md-nav__link" for="__nav_5">
        API
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../API_BREW/" class="md-nav__link">
        brew
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../API_EVAL/" class="md-nav__link">
        eval
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../API_GEO/" class="md-nav__link">
        geo
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          io
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        io
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#patentcity.io" class="md-nav__link">
    patentcity.io
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.augment_patentcity" class="md-nav__link">
    augment_patentcity()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.build_wgp_as_patentcity" class="md-nav__link">
    build_wgp_as_patentcity()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.deduplicate" class="md-nav__link">
    deduplicate()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.extract_sample_kepler" class="md-nav__link">
    extract_sample_kepler()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.family_expansion" class="md-nav__link">
    family_expansion()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.filter_kind_codes" class="md-nav__link">
    filter_kind_codes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.get_stratified_sample" class="md-nav__link">
    get_stratified_sample()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.get_wgp25_recid" class="md-nav__link">
    get_wgp25_recid()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.impute_publication_date" class="md-nav__link">
    impute_publication_date()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.order" class="md-nav__link">
    order()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../API_SEARCH/" class="md-nav__link">
        search
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        License
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="License" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          License
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE_CODE/" class="md-nav__link">
        Code
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE_DATA/" class="md-nav__link">
        Data
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#patentcity.io" class="md-nav__link">
    patentcity.io
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.augment_patentcity" class="md-nav__link">
    augment_patentcity()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.build_wgp_as_patentcity" class="md-nav__link">
    build_wgp_as_patentcity()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.deduplicate" class="md-nav__link">
    deduplicate()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.extract_sample_kepler" class="md-nav__link">
    extract_sample_kepler()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.family_expansion" class="md-nav__link">
    family_expansion()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.filter_kind_codes" class="md-nav__link">
    filter_kind_codes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.get_stratified_sample" class="md-nav__link">
    get_stratified_sample()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.get_wgp25_recid" class="md-nav__link">
    get_wgp25_recid()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.impute_publication_date" class="md-nav__link">
    impute_publication_date()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patentcity.io.order" class="md-nav__link">
    order()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cverluise/patentcity/edit/master/docs/API_IO.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>io</h1>
                
                <div class="doc doc-object doc-module">

<a id="patentcity.io"></a>
    <div class="doc doc-contents first">




  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h2 id="patentcity.io.augment_patentcity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">augment_patentcity</span><span class="p">(</span><span class="n">src_table</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#patentcity.io.augment_patentcity" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Add (mainly interoperability) variables to <code>src_table</code> and save to `destination_table</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src_table</code></td>
        <td><code>str</code></td>
        <td><p>source table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>destination_table</code></td>
        <td><code>str</code></td>
        <td><p>destination table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>credentials</code></td>
        <td><code>str</code></td>
        <td><p>BQ credentials file path</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>      <p><strong>Usage:</strong>
    <div class="highlight"><pre><span></span><code>patentcity io augment-patentcity &lt;src_table&gt; &lt;destination_table&gt; credentials-patentcity.json
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>patentcity/io.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">augment_patentcity</span><span class="p">(</span><span class="n">src_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add (mainly interoperability) variables to `src_table` and save to `destination_table</span>

<span class="sd">    Arguments:</span>
<span class="sd">        src_table: source table (project.dataset.table)</span>
<span class="sd">        destination_table: destination table (project.dataset.table)</span>
<span class="sd">        credentials: BQ credentials file path</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        ```shell</span>
<span class="sd">        patentcity io augment-patentcity &lt;src_table&gt; &lt;destination_table&gt; credentials-patentcity.json</span>
<span class="sd">        ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">      pc.publication_number,</span>
<span class="s2">      p.publication_date,</span>
<span class="s2">      p.family_id,</span>
<span class="s2">      SPLIT(pc.publication_number, &quot;-&quot;)[OFFSET(0)] AS country_code,</span>
<span class="s2">      SPLIT(pc.publication_number, &quot;-&quot;)[OFFSET(1)] AS pubnum,</span>
<span class="s2">      SPLIT(pc.publication_number, &quot;-&quot;)[OFFSET(2)] AS kind_code,</span>
<span class="s2">      pc.* EXCEPT(publication_number)</span>
<span class="s2">    FROM</span>
<span class="s2">      `patents-public-data.patents.publications` AS p</span>
<span class="s2">    RIGHT JOIN</span>
<span class="s2">      `</span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2">` AS pc</span>
<span class="s2">    ON</span>
<span class="s2">      pc.publication_number = p.publication_number</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">_get_job_done</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="patentcity.io.build_wgp_as_patentcity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_wgp_as_patentcity</span><span class="p">(</span><span class="n">addresses_table</span><span class="p">,</span> <span class="n">patentee_location_table</span><span class="p">,</span> <span class="n">patstat_patent_properties_table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tls206_table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tls207_table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">destination_table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flavor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#patentcity.io.build_wgp_as_patentcity" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Join addresses and individuals from WGP and add data at the patent as well as individual level.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>addresses_table</code></td>
        <td><code>str</code></td>
        <td><p>WGP addresses table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>patentee_location_table</code></td>
        <td><code>str</code></td>
        <td><p>WGP patentees table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>patstat_patent_properties_table</code></td>
        <td><code>str</code></td>
        <td><p>PATSTAT patent properties table on BQ (project.dataset.table)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>tls206_table</code></td>
        <td><code>str</code></td>
        <td><p>PATSTAT tls206 table on BQ (project.dataset.table)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>tls207_table</code></td>
        <td><code>str</code></td>
        <td><p>PATSTAT tls207 table on BQ (project.dataset.table)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>destination_table</code></td>
        <td><code>str</code></td>
        <td><p>destination table (project.dataset.table)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>flavor</code></td>
        <td><code>int</code></td>
        <td><p>WGP source data flavor (in [25, 45])</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>credentials</code></td>
        <td><code>str</code></td>
        <td><p>BQ credentials file path</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>      <p><strong>Usage:</strong>
    <div class="highlight"><pre><span></span><code>patentcity io build-wgp-as-patentcity patentcity.external.addresses_florian45_patentcity patentcity.external.person_location_id --tls206-table patentcity.external.tls206 --tls207-table patentcity.external.tls207 --patstat-patent-properties-table patentcity.external.patstat_patent_properties --destination-table patentcity.tmp.patentcity45 --flavor <span class="m">45</span> --key-file <span class="nv">$KEY_FILE</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>patentcity/io.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">build_wgp_as_patentcity</span><span class="p">(</span>
    <span class="n">addresses_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">patentee_location_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">patstat_patent_properties_table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tls206_table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tls207_table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">destination_table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">flavor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Join addresses and individuals from WGP and add data at the patent as well as individual level.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        addresses_table: WGP addresses table (project.dataset.table)</span>
<span class="sd">        patentee_location_table: WGP patentees table (project.dataset.table)</span>
<span class="sd">        patstat_patent_properties_table: PATSTAT patent properties table on BQ (project.dataset.table)</span>
<span class="sd">        tls206_table: PATSTAT tls206 table on BQ (project.dataset.table)</span>
<span class="sd">        tls207_table: PATSTAT tls207 table on BQ (project.dataset.table)</span>
<span class="sd">        destination_table: destination table (project.dataset.table)</span>
<span class="sd">        flavor: WGP source data flavor (in [25, 45])</span>
<span class="sd">        credentials: BQ credentials file path</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        ```shell</span>
<span class="sd">        patentcity io build-wgp-as-patentcity patentcity.external.addresses_florian45_patentcity patentcity.external.person_location_id --tls206-table patentcity.external.tls206 --tls207-table patentcity.external.tls207 --patstat-patent-properties-table patentcity.external.patstat_patent_properties --destination-table patentcity.tmp.patentcity45 --flavor 45 --key-file $KEY_FILE</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">flavor</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">patentee_location_table</span>
    <span class="k">assert</span> <span class="n">addresses_table</span>
    <span class="k">if</span> <span class="n">flavor</span> <span class="o">==</span> <span class="mi">25</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        WITH</span>
<span class="s2">          tmp AS (</span>
<span class="s2">          SELECT</span>
<span class="s2">            patee.* EXCEPT(recId),</span>
<span class="s2">            loc.*,</span>
<span class="s2">            app_inv=&quot;INV&quot; AS is_inv,</span>
<span class="s2">            app_inv=&quot;APP&quot; AS is_app</span>
<span class="s2">          FROM (</span>
<span class="s2">            SELECT</span>
<span class="s2">              *</span>
<span class="s2">            FROM</span>
<span class="s2">              `</span><span class="si">{</span><span class="n">addresses_table</span><span class="si">}</span><span class="s2">`  # patentcity.external.addresses_cyril25_patentcity</span>
<span class="s2">            WHERE</span>
<span class="s2">              seqNumber = 1</span>
<span class="s2">              AND (matchLevel=&quot;NOMATCH&quot; AND source=&quot;HERE&quot;) IS FALSE ) AS loc</span>
<span class="s2">          JOIN</span>
<span class="s2">            `</span><span class="si">{</span><span class="n">patentee_location_table</span><span class="si">}</span><span class="s2">` AS patee</span>
<span class="s2">            # patentcity.external.inventor_applicant_recid</span>
<span class="s2">          ON</span>
<span class="s2">            loc.recId = patee.recId )  # location_id</span>
<span class="s2">        SELECT</span>
<span class="s2">          tmp.* EXCEPT(appln_id, pat_publn_id),</span>
<span class="s2">          patstat.*,</span>
<span class="s2">          SPLIT(patstat.publication_number, &quot;-&quot;)[OFFSET(0)] AS country_code,</span>
<span class="s2">          SPLIT(patstat.publication_number, &quot;-&quot;)[OFFSET(1)] AS pubnum,</span>
<span class="s2">          SPLIT(patstat.publication_number, &quot;-&quot;)[OFFSET(2)] AS kind_code</span>
<span class="s2">        FROM</span>
<span class="s2">          tmp</span>
<span class="s2">        LEFT JOIN</span>
<span class="s2">          `</span><span class="si">{</span><span class="n">patstat_patent_properties_table</span><span class="si">}</span><span class="s2">` AS patstat</span>
<span class="s2">        ON</span>
<span class="s2">          tmp.pat_publn_id = patstat.pat_publn_id #tmp.appln_id = patstat.appln_id</span>
<span class="s2">          # here we are at the publication level, not the patent level</span>
<span class="s2">        WHERE</span>
<span class="s2">          SPLIT(patstat.publication_number, &quot;-&quot;)[OFFSET(0)] IN (&quot;DE&quot;, &quot;GB&quot;, &quot;FR&quot;, &quot;US&quot;)</span>

<span class="s2">        &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">flavor</span> <span class="o">==</span> <span class="mi">45</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">tls206_table</span>
        <span class="k">assert</span> <span class="n">tls207_table</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            WITH</span>
<span class="s2">              tmp AS (</span>
<span class="s2">              WITH</span>
<span class="s2">                tmp_ AS (</span>
<span class="s2">                WITH</span>
<span class="s2">                  person AS (</span>
<span class="s2">                  SELECT</span>
<span class="s2">                    tls207.*,</span>
<span class="s2">                    tls206.person_name,</span>
<span class="s2">                    invt_seq_nr &gt; 0 AS is_inv,</span>
<span class="s2">                    applt_seq_nr &gt; 0 AS is_asg</span>
<span class="s2">                  FROM</span>
<span class="s2">                    `</span><span class="si">{</span><span class="n">tls206_table</span><span class="si">}</span><span class="s2">` AS tls206,  # usptobias.patstat.tls206</span>
<span class="s2">                    `</span><span class="si">{</span><span class="n">tls207_table</span><span class="si">}</span><span class="s2">` AS tls207  # usptobias.patstat.tls207</span>
<span class="s2">                  WHERE</span>
<span class="s2">                    tls207.person_id=tls206.person_id )</span>
<span class="s2">                SELECT</span>
<span class="s2">                  patee.*,</span>
<span class="s2">                  person.* EXCEPT(person_id)</span>
<span class="s2">                FROM</span>
<span class="s2">                  `</span><span class="si">{</span><span class="n">patentee_location_table</span><span class="si">}</span><span class="s2">` AS patee  # patentcity.external.person_location_id</span>
<span class="s2">                LEFT JOIN</span>
<span class="s2">                  person</span>
<span class="s2">                ON</span>
<span class="s2">                  patee.person_id = person.person_id)</span>
<span class="s2">              SELECT</span>
<span class="s2">                *</span>
<span class="s2">              FROM</span>
<span class="s2">                tmp_</span>
<span class="s2">              LEFT JOIN</span>
<span class="s2">                `</span><span class="si">{</span><span class="n">addresses_table</span><span class="si">}</span><span class="s2">` AS loc  # patentcity.external.addresses_florian45_patentcity</span>
<span class="s2">              ON</span>
<span class="s2">                tmp_.location_id = loc.recId</span>
<span class="s2">              WHERE</span>
<span class="s2">                seqNumber = 1   )</span>
<span class="s2">            SELECT</span>
<span class="s2">              tmp.* EXCEPT(appln_id),</span>
<span class="s2">              patstat.*,</span>
<span class="s2">              SPLIT(patstat.publication_number, &quot;-&quot;)[OFFSET(0)] AS country_code,</span>
<span class="s2">              SPLIT(patstat.publication_number, &quot;-&quot;)[OFFSET(1)] AS pubnum,</span>
<span class="s2">              SPLIT(patstat.publication_number, &quot;-&quot;)[OFFSET(2)] AS kind_code</span>
<span class="s2">            FROM</span>
<span class="s2">              tmp</span>
<span class="s2">            LEFT JOIN</span>
<span class="s2">              `</span><span class="si">{</span><span class="n">patstat_patent_properties_table</span><span class="si">}</span><span class="s2">` AS patstat</span>
<span class="s2">            ON</span>
<span class="s2">              tmp.appln_id = patstat.appln_id</span>
<span class="s2">              # here we are at the the patent level</span>
<span class="s2">            WHERE</span>
<span class="s2">              SPLIT(patstat.publication_number, &quot;-&quot;)[OFFSET(0)] IN (&quot;DE&quot;, &quot;GB&quot;, &quot;FR&quot;, &quot;US&quot;)</span>
<span class="s2">            &quot;&quot;&quot;</span>
    <span class="n">_get_job_done</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="patentcity.io.deduplicate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">deduplicate</span><span class="p">(</span><span class="n">src_table</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span></code>


<a href="#patentcity.io.deduplicate" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Deduplicate patentcity table from publications which are both in at least 2 of the following data sources PC, WGP45
and WGP25. We prioritize PC, then WGP45 and then WGP25.</p>
<div class="admonition argument">
<p class="admonition-title">Argument</p>
<p>src_table: source table (project.dataset.table)
destination_table: destination table (project.dataset.table)
credentials: BQ credentials file path</p>
</div>
<p><strong>Usage:</strong>
    <div class="highlight"><pre><span></span><code>patentcity io deduplicate &lt;src-table&gt; &lt;destination-table&gt; credentials-patentcity.json
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>patentcity/io.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">deduplicate</span><span class="p">(</span><span class="n">src_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deduplicate patentcity table from publications which are both in at least 2 of the following data sources PC, WGP45</span>
<span class="sd">    and WGP25. We prioritize PC, then WGP45 and then WGP25.</span>

<span class="sd">    Argument:</span>
<span class="sd">        src_table: source table (project.dataset.table)</span>
<span class="sd">        destination_table: destination table (project.dataset.table)</span>
<span class="sd">        credentials: BQ credentials file path</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        ```shell</span>
<span class="sd">        patentcity io deduplicate &lt;src-table&gt; &lt;destination-table&gt; credentials-patentcity.json</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    WITH</span>
<span class="s2">      duplicates AS (</span>
<span class="s2">      SELECT</span>
<span class="s2">        publication_number,</span>
<span class="s2">        COUNT(publication_number) AS nb_occ,</span>
<span class="s2">        STRING_AGG(DISTINCT(origin)) AS origins</span>
<span class="s2">      FROM</span>
<span class="s2">        </span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2"> #`patentcity.tmp.v100rc5`</span>
<span class="s2">      GROUP BY</span>
<span class="s2">        publication_number),</span>
<span class="s2">      keep_list AS (</span>
<span class="s2">      SELECT</span>
<span class="s2">        tmp.publication_number,</span>
<span class="s2">        tmp.origin,</span>
<span class="s2">        duplicates.* EXCEPT(publication_number),</span>
<span class="s2">        CASE</span>
<span class="s2">          WHEN nb_occ = 1 THEN TRUE</span>
<span class="s2">          WHEN nb_occ &gt; 1 AND origins LIKE &quot;%PC%&quot; AND origin=&quot;PC&quot; THEN TRUE</span>
<span class="s2">          WHEN nb_occ &gt; 1 AND origins LIKE &quot;%WGP45%&quot; AND origins NOT LIKE &quot;%PC%&quot; AND origin=&quot;WGP45&quot; THEN TRUE</span>
<span class="s2">          WHEN nb_occ &gt; 1 AND origins LIKE &quot;%WGP25%&quot; AND origins NOT LIKE &quot;%PC%&quot; AND origins NOT LIKE &quot;%WGP45%&quot; AND origin=&quot;WGP25&quot; THEN TRUE</span>
<span class="s2">        ELSE FALSE</span>
<span class="s2">      END</span>
<span class="s2">        AS keep</span>
<span class="s2">      FROM</span>
<span class="s2">        </span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2"> AS tmp  # `patentcity.tmp.v100rc5`</span>
<span class="s2">      LEFT JOIN</span>
<span class="s2">        duplicates</span>
<span class="s2">      ON</span>
<span class="s2">        tmp.publication_number = duplicates.publication_number )</span>
<span class="s2">    SELECT</span>
<span class="s2">      tmp.*#,</span>
<span class="s2">      #keep_list.* EXCEPT(publication_number, origin) ## for dbg</span>
<span class="s2">    FROM</span>
<span class="s2">      </span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2"> AS tmp  # `patentcity.tmp.v100rc5`</span>
<span class="s2">    LEFT JOIN</span>
<span class="s2">      keep_list</span>
<span class="s2">    ON</span>
<span class="s2">      tmp.publication_number=keep_list.publication_number</span>
<span class="s2">      AND tmp.origin=keep_list.origin</span>
<span class="s2">    WHERE keep IS TRUE  &quot;&quot;&quot;</span>
    <span class="n">_get_job_done</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="patentcity.io.extract_sample_kepler" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_sample_kepler</span><span class="p">(</span><span class="n">src_table</span><span class="p">,</span> <span class="n">dest_file</span><span class="p">,</span> <span class="n">sample_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">office</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#patentcity.io.extract_sample_kepler" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Extract sample for kepler.gl</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src_table</code></td>
        <td><code>str</code></td>
        <td><p>source table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dest_file</code></td>
        <td><code>str</code></td>
        <td><p>destination file path (local)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>sample_ratio</code></td>
        <td><code>float</code></td>
        <td><p>share of patents to extract</p></td>
        <td><code>0.1</code></td>
      </tr>
      <tr>
        <td><code>office</code></td>
        <td><code>str</code></td>
        <td><p>patent office two letter-code (e.g. DD, DE, FR, etc)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>credentials</code></td>
        <td><code>str</code></td>
        <td><p>BQ credentials file path</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>      <p><strong>Usage:</strong>
    <div class="highlight"><pre><span></span><code>patentcity io extract-sample-kepler &lt;src_table&gt; &lt;dest_file&gt; --office DE --credentials credentials-patentcity.json
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>patentcity/io.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">extract_sample_kepler</span><span class="p">(</span>
    <span class="n">src_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">dest_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sample_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">office</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract sample for kepler.gl</span>

<span class="sd">    Arguments:</span>
<span class="sd">        src_table: source table (project.dataset.table)</span>
<span class="sd">        dest_file: destination file path (local)</span>
<span class="sd">        sample_ratio: share of patents to extract</span>
<span class="sd">        office: patent office two letter-code (e.g. DD, DE, FR, etc)</span>
<span class="sd">        credentials: BQ credentials file path</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        ```shell</span>
<span class="sd">        patentcity io extract-sample-kepler &lt;src_table&gt; &lt;dest_file&gt; --office DE --credentials credentials-patentcity.json</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">office_clause</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;AND country_code=&quot;</span><span class="si">{</span><span class="n">office</span><span class="si">}</span><span class="s2">&quot; &quot;&quot;&quot;</span> <span class="k">if</span> <span class="n">office</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">      publication_number,</span>
<span class="s2">      country_code,</span>
<span class="s2">      CAST(publication_date/10000 AS INT64) AS publication_year,</span>
<span class="s2">      PARSE_TIMESTAMP(&#39;%Y%m%d%H%M%S&#39;, CAST(publication_date*100000 AS STRING)) as publication_date,</span>
<span class="s2">      patentee.loc_country as country,</span>
<span class="s2">      patentee.loc_city as city,</span>
<span class="s2">      patentee.loc_latitude as point_latitude,</span>
<span class="s2">      patentee.loc_longitude as point_longitude</span>
<span class="s2">    FROM</span>
<span class="s2">      </span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2">,</span>
<span class="s2">      UNNEST(patentee) AS patentee</span>
<span class="s2">    WHERE</span>
<span class="s2">      RAND()&lt;</span><span class="si">{</span><span class="n">sample_ratio</span><span class="si">}</span><span class="s2"></span>
<span class="s2">      AND publication_date&gt;0</span>
<span class="s2">      AND patentee.loc_source IS NOT NULL</span>
<span class="s2">      AND patentee.loc_latitude IS NOT NULL</span>
<span class="s2">      </span><span class="si">{</span><span class="n">office_clause</span><span class="si">}</span><span class="s2"></span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">_get_bq_client</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start:</span><span class="se">\n</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BLUE</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">dest_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ok</span><span class="si">}</span><span class="s2">Extract for Kepler saved to </span><span class="si">{</span><span class="n">dest_file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">GREEN</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="patentcity.io.family_expansion" class="doc doc-heading">
<code class="highlight language-python"><span class="n">family_expansion</span><span class="p">(</span><span class="n">src_table</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">destination_schema</span><span class="p">)</span></code>


<a href="#patentcity.io.family_expansion" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Expand along families in <code>table ref</code>. The returned table contains all publications belonging to a family
existing in <code>src_table</code> <em>but</em> absent from the latter. Family data are <em>assigned</em> from data in <code>src_table</code>.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src_table</code></td>
        <td><code>str</code></td>
        <td><p>source table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>destination_table</code></td>
        <td><code>str</code></td>
        <td><p>destination table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>credentials</code></td>
        <td><code>str</code></td>
        <td><p>BQ credentials file path</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>destination_schema</code></td>
        <td><code>str</code></td>
        <td><p>destination schema file path</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>      <p><strong>Usage:</strong>
    <div class="highlight"><pre><span></span><code>patentcity io family-expansion &lt;src-table&gt; &lt;destination-table&gt;  credentials-patentcity.json schema/patentcity_v1.json
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>patentcity/io.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">family_expansion</span><span class="p">(</span>
    <span class="n">src_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">destination_schema</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Expand along families in `table ref`. The returned table contains all publications belonging to a family</span>
<span class="sd">    existing in `src_table` *but* absent from the latter. Family data are *assigned* from data in `src_table`.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        src_table: source table (project.dataset.table)</span>
<span class="sd">        destination_table: destination table (project.dataset.table)</span>
<span class="sd">        credentials: BQ credentials file path</span>
<span class="sd">        destination_schema: destination schema file path</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        ```shell</span>
<span class="sd">        patentcity io family-expansion &lt;src-table&gt; &lt;destination-table&gt;  credentials-patentcity.json schema/patentcity_v1.json</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    WITH</span>
<span class="s2">      family_table AS (</span>
<span class="s2">      SELECT</span>
<span class="s2">        family_id,</span>
<span class="s2">        ANY_VALUE(patentee) as patentee</span>
<span class="s2">      FROM</span>
<span class="s2">        `</span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2">`  # patentcity.patentcity.v100rc4</span>
<span class="s2">     GROUP BY</span>
<span class="s2">      family_id   ),</span>
<span class="s2">      publication_list AS (</span>
<span class="s2">      SELECT</span>
<span class="s2">        DISTINCT(publication_number) AS publication_number</span>
<span class="s2">      FROM</span>
<span class="s2">        `</span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2">`),  # patentcity.patentcity.v100rc4</span>
<span class="s2">      expanded_family_table AS (</span>
<span class="s2">      SELECT</span>
<span class="s2">        p.publication_number,</span>
<span class="s2">        p.publication_date,</span>
<span class="s2">        family_table.*</span>
<span class="s2">      FROM</span>
<span class="s2">        `patents-public-data.patents.publications`AS p,</span>
<span class="s2">        family_table</span>
<span class="s2">      WHERE</span>
<span class="s2">        p.family_id = family_table.family_id</span>
<span class="s2">        AND family_table.family_id IS NOT NULL</span>
<span class="s2">        AND SPLIT(p.publication_number, &quot;-&quot;)[OFFSET(0)] in (&quot;DD&quot;,&quot;DE&quot;, &quot;FR&quot;, &quot;GB&quot;, &quot;US&quot;))#,</span>

<span class="s2">    SELECT</span>
<span class="s2">    expanded_family_table.*, #EXCEPT(appln_id, pat_publn_id, docdb_family_id, inpadoc_family_id),</span>
<span class="s2">    SPLIT(expanded_family_table.publication_number, &quot;-&quot;)[OFFSET(0)] as country_code,</span>
<span class="s2">    SPLIT(expanded_family_table.publication_number, &quot;-&quot;)[OFFSET(1)] as pubnum,</span>
<span class="s2">    SPLIT(expanded_family_table.publication_number, &quot;-&quot;)[OFFSET(2)] as kind_code,</span>
<span class="s2">    &quot;EXP&quot; AS origin</span>
<span class="s2">    FROM</span>
<span class="s2">    publication_list</span>
<span class="s2">    RIGHT JOIN</span>
<span class="s2">    expanded_family_table</span>
<span class="s2">    ON</span>
<span class="s2">    expanded_family_table.publication_number=publication_list.publication_number</span>
<span class="s2">    WHERE publication_list.publication_number IS NULL</span>
<span class="s2">  &quot;&quot;&quot;</span>
    <span class="n">_get_job_done</span><span class="p">(</span>
        <span class="n">query</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">destination_schema</span><span class="o">=</span><span class="n">destination_schema</span>
    <span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="patentcity.io.filter_kind_codes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_kind_codes</span><span class="p">(</span><span class="n">src_table</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span></code>


<a href="#patentcity.io.filter_kind_codes" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Filter <code>src_table</code> to make sure that only <em>utility patents</em> are reported.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src_table</code></td>
        <td><code>str</code></td>
        <td><p>source table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>destination_table</code></td>
        <td><code>str</code></td>
        <td><p>destination table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>credentials</code></td>
        <td><code>str</code></td>
        <td><p>BQ credentials file path</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>      <p><strong>Usage:</strong>
    <div class="highlight"><pre><span></span><code>patentcity io filter-kind-codes &lt;src_table&gt; &lt;destination_table&gt; credentials-patentcity.json
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>patentcity/io.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">filter_kind_codes</span><span class="p">(</span><span class="n">src_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Filter `src_table` to make sure that only *utility patents* are reported.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        src_table: source table (project.dataset.table)</span>
<span class="sd">        destination_table: destination table (project.dataset.table)</span>
<span class="sd">        credentials: BQ credentials file path</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        ```shell</span>
<span class="sd">        patentcity io filter-kind-codes &lt;src_table&gt; &lt;destination_table&gt; credentials-patentcity.json</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    WITH keep_list AS (</span>
<span class="s2">    SELECT</span>
<span class="s2">      publication_number,</span>
<span class="s2">      CASE</span>
<span class="s2">        WHEN country_code = &quot;DD&quot; AND (kind_code in (&quot;A&quot;, &quot;A1&quot;, &quot;A3&quot;, &quot;B&quot;)) THEN TRUE</span>
<span class="s2">        WHEN country_code = &quot;DE&quot; AND (kind_code in (&quot;A1&quot;, &quot;B&quot;, &quot;B3&quot;, &quot;C&quot;, &quot;C1&quot;, &quot;D1&quot;)) THEN TRUE</span>
<span class="s2">        WHEN country_code = &quot;FR&quot; AND (kind_code in (&quot;A&quot;, &quot;A1&quot;)) THEN TRUE</span>
<span class="s2">        WHEN country_code = &quot;GB&quot; AND (kind_code in (&quot;A&quot;)) THEN TRUE</span>
<span class="s2">        WHEN country_code = &quot;US&quot; AND (kind_code in (&quot;A&quot;, &quot;B1&quot;, &quot;B2&quot;)) THEN TRUE</span>
<span class="s2">        ELSE FALSE</span>
<span class="s2">      END AS keep</span>
<span class="s2">    FROM</span>
<span class="s2">      `</span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2">`) # patentcity.patentcity.v100rc4</span>
<span class="s2">    SELECT</span>
<span class="s2">      origin.* FROM</span>
<span class="s2">      `</span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2">` as origin,  # patentcity.patentcity.v100rc4</span>
<span class="s2">      keep_list</span>
<span class="s2">      WHERE</span>
<span class="s2">        keep_list.publication_number = origin.publication_number</span>
<span class="s2">        AND keep_list.keep IS TRUE</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">_get_job_done</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="patentcity.io.get_stratified_sample" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_stratified_sample</span><span class="p">(</span><span class="n">src_table</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">preview</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">destination_table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#patentcity.io.get_stratified_sample" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Return a stratified sample of <code>src_table</code> (based on country_code and publication_decade) with <code>bin_size</code> samples
in each bin (if possible).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src_table</code></td>
        <td><code>str</code></td>
        <td><p>source table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>bin_size</code></td>
        <td><code>int</code></td>
        <td><p>bin size</p></td>
        <td><code>50</code></td>
      </tr>
      <tr>
        <td><code>preview</code></td>
        <td><code>bool</code></td>
        <td><p>if True, output not saved and table stats to stdout. Else, output saved to <code>destination_table</code></p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>destination_table</code></td>
        <td><code>str</code></td>
        <td><p>destination table (project.dataset.table)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>credentials</code></td>
        <td><code>str</code></td>
        <td><p>BQ credentials file path</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>      <p><strong>Usage:</strong>
    <div class="highlight"><pre><span></span><code>patentcity io get-stratified-sample patentcity.patentcity.v1
</code></pre></div></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><a href="https://stackoverflow.com/questions/52901451/stratified-random-sampling-with-bigquery">Stratified random sampling with bigquery - StackOverflow</a></p>
</div>

        <details class="quote">
          <summary>Source code in <code>patentcity/io.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_stratified_sample</span><span class="p">(</span>
    <span class="n">src_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">bin_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">preview</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">destination_table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a stratified sample of `src_table` (based on country_code and publication_decade) with `bin_size` samples</span>
<span class="sd">    in each bin (if possible).</span>

<span class="sd">    Arguments:</span>
<span class="sd">        src_table: source table (project.dataset.table)</span>
<span class="sd">        bin_size: bin size</span>
<span class="sd">        preview: if True, output not saved and table stats to stdout. Else, output saved to `destination_table`</span>
<span class="sd">        destination_table: destination table (project.dataset.table)</span>
<span class="sd">        credentials: BQ credentials file path</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        ```shell</span>
<span class="sd">        patentcity io get-stratified-sample patentcity.patentcity.v1</span>
<span class="sd">        ```</span>

<span class="sd">    !!! tip</span>
<span class="sd">        [Stratified random sampling with bigquery - StackOverflow](https://stackoverflow.com/questions/52901451/stratified-random-sampling-with-bigquery)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">preview</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT COUNT(*) nb_samples, country_code, publication_decade, ROUND(100*COUNT(*)/MAX(nb_bin),2) AS percentage</span>
<span class="s2">        FROM (</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">select</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;SELECT publication_number, publication_decade, country_code, nb_bin&quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;) GROUP BY country_code, publication_decade&quot;&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prefix</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;SELECT * &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    WITH tmp AS (</span>
<span class="s2">      SELECT CAST(publication_date/100000 AS INT64) AS publication_decade,</span>
<span class="s2">      * EXCEPT(patentee)</span>
<span class="s2">      FROM `</span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2">`,  # patentcity.patentcity.wgp_v1</span>
<span class="s2">            UNNEST(patentee) as patentee</span>
<span class="s2">        WHERE</span>
<span class="s2">        patentee.loc_text IS NOT NULL</span>
<span class="s2">        AND patentee.loc_source IS NOT NULL ),</span>
<span class="s2">      table_stats AS (</span>
<span class="s2">  SELECT *, SUM(nb_bin) OVER() AS nb_total</span>
<span class="s2">      FROM (</span>
<span class="s2">        SELECT</span>
<span class="s2">            country_code,</span>
<span class="s2">            CAST(publication_date/100000 AS INT64) AS publication_decade,</span>
<span class="s2">            COUNT(*) nb_bin</span>
<span class="s2">        FROM tmp</span>
<span class="s2">        GROUP BY country_code, publication_decade)</span>
<span class="s2">    )</span>
<span class="s2">    </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"></span>
<span class="s2">      </span><span class="si">{</span><span class="n">select</span><span class="si">}</span><span class="s2"></span>
<span class="s2">      FROM tmp</span>
<span class="s2">      JOIN table_stats</span>
<span class="s2">      USING(country_code, publication_decade)</span>
<span class="s2">      WHERE RAND()&lt; </span><span class="si">{</span><span class="n">bin_size</span><span class="si">}</span><span class="s2">/nb_bin</span>
<span class="s2">    </span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2"></span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">preview</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">_get_bq_client</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country_code&quot;</span><span class="p">,</span> <span class="s2">&quot;publication_decade&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nb samples: </span><span class="si">{</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;nb_samples&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BLUE</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_get_job_done</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="patentcity.io.get_wgp25_recid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_wgp25_recid</span><span class="p">(</span><span class="n">country_code</span><span class="p">,</span> <span class="n">src_table</span><span class="p">,</span> <span class="n">patstat_patent_properties_table</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span></code>


<a href="#patentcity.io.get_wgp25_recid" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Extract recId and searchText from wgp25 for patents published in <code>country_code</code>.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>country_code</code></td>
        <td><code>str</code></td>
        <td><p>country code of the patent office (e.g. DE, FR, GB, US, etc)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>src_table</code></td>
        <td><code>str</code></td>
        <td><p>source table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>patstat_patent_properties_table</code></td>
        <td><code>str</code></td>
        <td><p>PATSTAT patent properties table on BQ (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>destination_table</code></td>
        <td><code>str</code></td>
        <td><p>destination table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>credentials</code></td>
        <td><code>str</code></td>
        <td><p>BQ credentials file path</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>      <p><strong>Usage:</strong>
    <div class="highlight"><pre><span></span><code><span class="nv">OFFICE</span><span class="o">=</span>DE
patentcity io get-wgp25-recid <span class="nv">$OFFICE</span> patentcity.external.inventor_applicant_recid patentcity.tmp.loc_<span class="si">${</span><span class="p">(L)OFFICE</span><span class="si">}</span>patentwgp25 credentials-patentcity.json
</code></pre></div></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This function assumes that the recId has been added to inventor_applicant_locationid beforehand (using <code>utils.get_recid(address_)</code>).</p>
</div>

        <details class="quote">
          <summary>Source code in <code>patentcity/io.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_wgp25_recid</span><span class="p">(</span>
    <span class="n">country_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">src_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">patstat_patent_properties_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">destination_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract recId and searchText from wgp25 for patents published in `country_code`.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        country_code: country code of the patent office (e.g. DE, FR, GB, US, etc)</span>
<span class="sd">        src_table: source table (project.dataset.table)</span>
<span class="sd">        patstat_patent_properties_table: PATSTAT patent properties table on BQ (project.dataset.table)</span>
<span class="sd">        destination_table: destination table (project.dataset.table)</span>
<span class="sd">        credentials: BQ credentials file path</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        ```shell</span>
<span class="sd">        OFFICE=DE</span>
<span class="sd">        patentcity io get-wgp25-recid $OFFICE patentcity.external.inventor_applicant_recid patentcity.tmp.loc_${(L)OFFICE}patentwgp25 credentials-patentcity.json</span>
<span class="sd">        ```</span>

<span class="sd">    !!! info</span>
<span class="sd">        This function assumes that the recId has been added to inventor_applicant_locationid beforehand (using `utils.get_recid(address_)`).&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">country_code</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    WITH</span>
<span class="s2">      tmp AS (</span>
<span class="s2">      SELECT</span>
<span class="s2">        loc.*,</span>
<span class="s2">        patstat.*,</span>
<span class="s2">        SPLIT(patstat.publication_number, &quot;-&quot;)[OFFSET(0)] AS country_code</span>
<span class="s2">      FROM</span>
<span class="s2">        `</span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2">` AS loc,  # patentcity.external.inventor_applicant_recid</span>
<span class="s2">        `</span><span class="si">{</span><span class="n">patstat_patent_properties_table</span><span class="si">}</span><span class="s2">` AS patstat  # patentcity.external.patstat_patent_properties</span>
<span class="s2">      WHERE</span>
<span class="s2">        loc.appln_id = patstat.appln_id</span>
<span class="s2">        AND loc.appln_id IS NOT NULL</span>
<span class="s2">        AND SPLIT(patstat.publication_number, &quot;-&quot;)[OFFSET(0)] IN &quot;</span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">      recId,</span>
<span class="s2">      ANY_VALUE(address_) AS searchText</span>
<span class="s2">    FROM</span>
<span class="s2">      tmp</span>
<span class="s2">    GROUP BY</span>
<span class="s2">      recId</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">_get_job_done</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="patentcity.io.impute_publication_date" class="doc doc-heading">
<code class="highlight language-python"><span class="n">impute_publication_date</span><span class="p">(</span><span class="n">src_table</span><span class="p">,</span> <span class="n">imputation_table</span><span class="p">,</span> <span class="n">country_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#patentcity.io.impute_publication_date" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Update <code>src_table</code> publication_date - DE &amp; DD only</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src_table</code></td>
        <td><code>str</code></td>
        <td><p>source table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>imputation_table</code></td>
        <td><code>str</code></td>
        <td><p>imputation table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>country_code</code></td>
        <td><code>str</code></td>
        <td><p>in ["DE", "DD"]</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>credentials</code></td>
        <td><code>str</code></td>
        <td><p>BQ credentials file path</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>      <p><strong>Usage:</strong>
    <div class="highlight"><pre><span></span><code>patentcity io impute-publication-date &lt;src_table&gt; &lt;imputation_table&gt; --country-code DE --credentials credentials-patentcity.json
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>patentcity/io.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">impute_publication_date</span><span class="p">(</span>
    <span class="n">src_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">imputation_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">country_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update `src_table` publication_date - DE &amp; DD only</span>

<span class="sd">    Arguments:</span>
<span class="sd">        src_table: source table (project.dataset.table)</span>
<span class="sd">        imputation_table: imputation table (project.dataset.table)</span>
<span class="sd">        country_code: in [&quot;DE&quot;, &quot;DD&quot;]</span>
<span class="sd">        credentials: BQ credentials file path</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        ```shell</span>
<span class="sd">        patentcity io impute-publication-date &lt;src_table&gt; &lt;imputation_table&gt; --country-code DE --credentials credentials-patentcity.json</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">de_clause</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;AND CAST(t.pubnum AS INT64)&lt;330000&quot;&quot;&quot;</span> <span class="k">if</span> <span class="n">country_code</span> <span class="o">==</span> <span class="s2">&quot;DE&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;UPDATE</span>
<span class="s2">      `</span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2">` AS t</span>
<span class="s2">    SET</span>
<span class="s2">      t.publication_date = imputation.publication_date</span>
<span class="s2">    FROM</span>
<span class="s2">      `</span><span class="si">{</span><span class="n">imputation_table</span><span class="si">}</span><span class="s2">` AS imputation</span>
<span class="s2">    WHERE</span>
<span class="s2">      t.pubnum = imputation.pubnum</span>
<span class="s2">      AND country_code=&quot;</span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">      </span><span class="si">{</span><span class="n">de_clause</span><span class="si">}</span><span class="s2"></span>

<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">_get_bq_client</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start:</span><span class="se">\n</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BLUE</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

    <span class="n">typer</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ok</span><span class="si">}{</span><span class="n">src_table</span><span class="si">}</span><span class="s2"> updated.&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">GREEN</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="patentcity.io.order" class="doc doc-heading">
<code class="highlight language-python"><span class="n">order</span><span class="p">(</span><span class="n">src_table</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">destination_table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#patentcity.io.order" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Order <code>src_table</code> by <code>by</code> and stage it onto <code>destination_table</code></p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src_table</code></td>
        <td><code>str</code></td>
        <td><p>source table (project.dataset.table)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>by</code></td>
        <td><code>str</code></td>
        <td><p>ordering dimension (e.g. publication_number)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>destination_table</code></td>
        <td><code>str</code></td>
        <td><p>destination table (project.dataset.table)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>credentials</code></td>
        <td><code>str</code></td>
        <td><p>BQ credentials file path</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>      <p><strong>Usage:</strong>
    <div class="highlight"><pre><span></span><code>patentcity io order patentcity.tmp.patentcity25 --by publication_number --destination-table patentcity.tmp.tmp25 --key-file credentials-patentcity.json
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>patentcity/io.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">(</span>
    <span class="n">src_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">destination_table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Order `src_table` by `by` and stage it onto `destination_table`</span>

<span class="sd">    Arguments:</span>
<span class="sd">        src_table: source table (project.dataset.table)</span>
<span class="sd">        by: ordering dimension (e.g. publication_number)</span>
<span class="sd">        destination_table: destination table (project.dataset.table)</span>
<span class="sd">        credentials: BQ credentials file path</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        ```shell</span>
<span class="sd">        patentcity io order patentcity.tmp.patentcity25 --by publication_number --destination-table patentcity.tmp.tmp25 --key-file credentials-patentcity.json</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">      *</span>
<span class="s2">    FROM</span>
<span class="s2">      `</span><span class="si">{</span><span class="n">src_table</span><span class="si">}</span><span class="s2">`</span>
<span class="s2">    ORDER BY</span>
<span class="s2">      </span><span class="si">{</span><span class="n">by</span><span class="si">}</span><span class="s2">  # publication_number</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">_get_job_done</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../API_GEO/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              geo
            </div>
          </div>
        </a>
      
      
        <a href="../API_SEARCH/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              search
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://twitter.com/cyrilverluise" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.linkedin.com/in/cyril-verluise-80184347/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
    
  </body>
</html>