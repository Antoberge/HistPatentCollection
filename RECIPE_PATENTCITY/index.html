
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Early age patents for humans and researchers">
      
      
      
        <meta name="author" content="Cyril Verluise">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.3">
    
    
      
        <title>PatentCity - patentCity</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e35208c4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#recipe-patentcity" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="patentCity" class="md-header__button md-logo" aria-label="patentCity" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            patentCity
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PatentCity
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/cverluise/patentcity/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      About
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../DATA/" class="md-tabs__link">
      Data
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../DD/" class="md-tabs__link md-tabs__link--active">
        Guides
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../API_BREW/" class="md-tabs__link">
        API
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../LICENSE_CODE/" class="md-tabs__link">
        License
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="patentCity" class="md-nav__button md-logo" aria-label="patentCity" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    patentCity
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/cverluise/patentcity/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../DATA/" class="md-nav__link">
        Data
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Guides
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      <label class="md-nav__link" for="__nav_3_1">
        DD
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DD" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          DD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DD/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DD_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DD_MODEL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        DE
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DE" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          DE
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DE/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DE_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DE_MODEL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      <label class="md-nav__link" for="__nav_3_3">
        FR
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="FR" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          FR
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../FR/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../FR_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../FR_MODEL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      <label class="md-nav__link" for="__nav_3_4">
        GB
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="GB" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          GB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../GB/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../GB_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../GB_MODEL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      <label class="md-nav__link" for="__nav_3_5">
        US
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="US" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          US
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../US/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../US_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../US_MODEL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" >
      
      <label class="md-nav__link" for="__nav_3_6">
        Relationship
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Relationship" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Relationship
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_REL_ANNOTATION_GUIDELINES/" class="md-nav__link">
        Annotation Guidelines
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_REL_CARD/" class="md-nav__link">
        Models
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_7" type="checkbox" id="__nav_3_7" >
      
      <label class="md-nav__link" for="__nav_3_7">
        Enrichment
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Enrichment" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Enrichment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DD_DATE_IMPUTATION/" class="md-nav__link">
        DD dates
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DE_DATE_IMPUTATION/" class="md-nav__link">
        DE dates
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_GEOC_REPORT/" class="md-nav__link">
        Geocoding
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_CIT_EVALUATION/" class="md-nav__link">
        Citizenship
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_STATISTICAL_AREAS/" class="md-nav__link">
        Statistical areas
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../XX_DEDUPLICATION_EVALUATION/" class="md-nav__link">
        Deduplication
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_8" type="checkbox" id="__nav_3_8" checked>
      
      <label class="md-nav__link" for="__nav_3_8">
        Recipes
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Recipes" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Recipes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          PatentCity
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        PatentCity
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#serialize-data" class="md-nav__link">
    Serialize data️
  </a>
  
    <nav class="md-nav" aria-label="Serialize data️">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-data" class="md-nav__link">
    Get data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-patentees-and-add-topping" class="md-nav__link">
    Extract patentees (and add topping)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-loc-data" class="md-nav__link">
    Get LOC data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geocode-dataset" class="md-nav__link">
    Geocode dataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-geocoded-data" class="md-nav__link">
    Add geocoded data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-data" class="md-nav__link">
    Build data
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../RECIPE_WGP/" class="md-nav__link">
        WGP
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../CHEATSHEET/" class="md-nav__link">
        Cheatsheet
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        API
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../API_BREW/" class="md-nav__link">
        brew
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../API_EVAL/" class="md-nav__link">
        eval
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../API_GEO/" class="md-nav__link">
        geo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../API_IO/" class="md-nav__link">
        io
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../API_SEARCH/" class="md-nav__link">
        search
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        License
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="License" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          License
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE_CODE/" class="md-nav__link">
        Code
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE_DATA/" class="md-nav__link">
        Data
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#serialize-data" class="md-nav__link">
    Serialize data️
  </a>
  
    <nav class="md-nav" aria-label="Serialize data️">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-data" class="md-nav__link">
    Get data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-patentees-and-add-topping" class="md-nav__link">
    Extract patentees (and add topping)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-loc-data" class="md-nav__link">
    Get LOC data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geocode-dataset" class="md-nav__link">
    Geocode dataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-geocoded-data" class="md-nav__link">
    Add geocoded data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-data" class="md-nav__link">
    Build data
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cverluise/patentcity/edit/master/docs/RECIPE_PATENTCITY.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="recipe-patentcity">RECIPE PATENTCITY<a class="headerlink" href="#recipe-patentcity" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The below snippets provide guidance for the main steps of the PatentCity pipeline.</p>
</div>
<h2 id="serialize-data">Serialize data️<a class="headerlink" href="#serialize-data" title="Permanent link">&para;</a></h2>
<h3 id="get-data">Get data<a class="headerlink" href="#get-data" title="Permanent link">&para;</a></h3>
<div class="tabbed-set" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">Preped data not available</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="c1"># get raw data</span>
gsutil -m cp <span class="s2">&quot;gs://patentcity_dev/v1/*patent*.txt.tar.gz&quot;</span> ./

<span class="c1"># Unpack data</span>
cat lib/formats.txt <span class="p">|</span> parallel --eta <span class="s1">&#39;tar -xvzf {}.txt.tar.gz -C ./{}&#39;</span>
<span class="c1"># then, you can go for a week-end</span>

<span class="c1"># Prepare data</span>
cat lib/formats.txt <span class="p">|</span> parallel --eta -j <span class="m">2</span> <span class="s1">&#39;patentcity brew v1.grind {}/*.txt &gt;&gt; {}.jsonl &amp;&amp; gzip {}.jsonl&#39;</span>
</code></pre></div>
</div>
<input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><label for="__tabbed_1_2">Preped data available</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code>gsutil -m cp <span class="s2">&quot;gs://patentcity_dev/v1/*.jsonl.gz&quot;</span> ./
<span class="c1"># should dl ddpatent01.jsonl.gz, ddpatent02.jsonl.gz, etc</span>
</code></pre></div>
</div>
</div>
<h3 id="extract-patentees-and-add-topping">Extract patentees (and add topping)<a class="headerlink" href="#extract-patentees-and-add-topping" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Extract entities (brew data)</span>
cat lib/formats.txt <span class="p">|</span> parallel --eta -j <span class="m">3</span> <span class="s1">&#39;MODEL=$(ls -d models/**/model-best | grep {} ) &amp;&amp; patentcity brew v1 {}.jsonl.gz ${MODEL} configs/rel_{}.yaml --batch-size 500 &gt;&gt; entrel_{}.jsonl&#39;</span>
<span class="c1"># Number of job for a 8 CPUs 32Gb ram machine</span>

<span class="c1"># Merge all format belonging to the same office in one single file</span>
<span class="k">for</span> OFFICE in  dd de fr gb us<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span> <span class="o">&amp;&amp;</span> cat entrel_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patent*.jsonl &gt;&gt; entrel_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.jsonl<span class="p">;</span> <span class="k">done</span><span class="p">;</span>

<span class="c1"># Add topping</span>
ls entrel_*patentxx.jsonl <span class="p">|</span> parallel --eta -j <span class="m">2</span> <span class="s1">&#39;mv {} {}_tmp &amp;&amp; patentcity brew v1.topping --config-file configs/top_xxpatentxx.yaml {}_tmp &gt;&gt; {} &#39;</span>
<span class="c1"># Note: it can be memory greedy, you might want to limit the nb or jobs and/or the nb of workers</span>

<span class="c1"># Check output not corrupted</span>
ls entrel_*patentxx.jsonl <span class="p">|</span> parallel <span class="s2">&quot;wc -l {}*&quot;</span>
</code></pre></div>
<h2 id="get-loc-data">Get LOC data<a class="headerlink" href="#get-loc-data" title="Permanent link">&para;</a></h2>
<div class="tabbed-set" data-tabs="2:4"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">All</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="c1"># Get loc data</span>
ls entrel_*patentxx.jsonl <span class="p">|</span>cut -d_ -f2 <span class="p">|</span>  parallel --eta <span class="s1">&#39;patentcity geo prep entrel_{} | sort -u &gt;&gt; loc_{.}.txt&#39;</span>

<span class="c1"># Prep geoc data</span>
ls loc_*patentxx.txt <span class="p">|</span> parallel --eta <span class="s1">&#39;mv {} {}_tmp &amp;&amp; patentcity utils prep-searchtext {}_tmp configs/{.}.yaml &gt;&gt; {}&#39;</span>
</code></pre></div>
</div>
<input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><label for="__tabbed_2_2">Not geocoded yet</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="c1"># Note: This is useful when you geocode the dataset in more than one pass (for example because of limited quotas)</span>
<span class="c1"># Below we assume that part of dataset has already been geocoded using HERE (loc_*patentxx.here.txt files) and we want  to geocode the rest (wrt the full list of loc in loc_*patentxx.txt) using GMAPS (in loc_*patentxx.tbd.txt).</span>
ls loc_*patentxx.txt <span class="p">|</span> parallel --eta <span class="s1">&#39;comm -13 &lt;(sort {.}.here.txt) &lt;(sort {}) &gt;&gt; {.}.tbd.txt&#39;</span>
</code></pre></div>
</div>
<input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><label for="__tabbed_2_3">Most reccurent loc</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code>ls entrel_*patentxx.jsonl <span class="p">|</span>cut -d_ -f2 <span class="p">|</span>  parallel --eta <span class="s1">&#39;patentcity geo prep entrel_{} | sort | uniq -c &gt;&gt; loc_{.}.count.txt&#39;</span>
ls loc_*patentxx.count.txt <span class="p">|</span> cut -d. -f <span class="m">1</span>,2 <span class="p">|</span> parallel --eta <span class="s1">&#39;mv {}.txt {}.txt_tmp &amp;&amp; patentcity utils prep-searchtext {}.txt_tmp configs/{.}.yaml &gt;&gt; {}.txt&#39;</span>
<span class="k">for</span> FILE in <span class="k">$(</span>ls loc_*patentxx.count.txt <span class="p">|</span> cut -d. -f <span class="m">1</span> <span class="k">)</span><span class="p">;</span> <span class="k">do</span> cat <span class="si">${</span><span class="nv">FILE</span><span class="si">}</span>.count.txt <span class="p">|</span> sort -nr  <span class="p">|</span>awk <span class="s1">&#39;{$1=&quot;&quot;; print $0}&#39;</span> <span class="p">|</span> cut -c2- &gt;&gt; <span class="si">${</span><span class="nv">FILE</span><span class="si">}</span>.sorted.txt<span class="p">;</span> <span class="k">done</span><span class="p">;</span>
<span class="c1"># nb sorted in descending order</span>

<span class="c1"># Now assume that you want to get 250k addresses to geocode, covering as many occurences as possible and making sure that they have not been geocoded yet</span>
<span class="c1"># Below, we get the 275k most cited addresses (unconditional) and we keep only those which are no yet done (ie in tbd as well)</span>
<span class="c1"># Nb requires a bit of fine tuning to make sure that we have the right nbr of lines:  rm -f tmp &amp;&amp; head -n 275000 loc_${FORMAT}.sorted.txt &gt;&gt; tmp &amp;&amp; comm -13 &lt;(sort loc_${FORMAT}.tbd.txt) &lt;(sort tmp) | wc -l</span>
<span class="nv">FORMAT</span><span class="o">=</span><span class="s2">&quot;uspatentxx&quot;</span>
rm -f tmp <span class="o">&amp;&amp;</span> head -n <span class="m">275000</span> loc_<span class="si">${</span><span class="nv">FORMAT</span><span class="si">}</span>.sorted.txt &gt;&gt; tmp <span class="o">&amp;&amp;</span> comm -13 &lt;<span class="o">(</span>sort loc_<span class="si">${</span><span class="nv">FORMAT</span><span class="si">}</span>.tbd.txt<span class="o">)</span> &lt;<span class="o">(</span>sort tmp<span class="o">)</span> <span class="p">|</span> sort -r &gt;&gt;  loc_<span class="si">${</span><span class="nv">FORMAT</span><span class="si">}</span>.tbd.txt_00
</code></pre></div>
</div>
<input id="__tabbed_2_4" name="__tabbed_2" type="radio" /><label for="__tabbed_2_4">HERE nomatch</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="nv">ROUND</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># e.g. 00</span>
<span class="k">for</span> OFFICE in dd de fr gb us<span class="p">;</span> <span class="k">do</span>
  patentcity utils get-recid-nomatch geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.here.csv_<span class="si">${</span><span class="nv">ROUND</span><span class="si">}</span>.gz loc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.tbd.txt_<span class="si">${</span><span class="nv">ROUND</span><span class="si">}</span> &gt;&gt; loc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.here.nomatch.txt_<span class="si">${</span><span class="nv">ROUND</span><span class="si">}</span><span class="p">;</span>
<span class="k">done</span><span class="p">;</span>
</code></pre></div>
</div>
</div>
<h2 id="geocode-dataset">Geocode dataset<a class="headerlink" href="#geocode-dataset" title="Permanent link">&para;</a></h2>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Take care, geocoding is not free, especially using GMAPS. Keep calm and plan your budget, you might want to ask for a grant and/or chunk the data and process it month-by-month as you free-tier gets automatically refilled. You might also want to first start with the batch geocoding API from HERE (which offers much more generous free plan) and use gmaps only for the no-match. NB: HERE batch geocoding API is supported by patentcity.</p>
</div>
<div class="tabbed-set" data-tabs="3:3"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><label for="__tabbed_3_1">HERE</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="c1"># Make sure that there is the appropriate header, ie recId|searchText</span>
<span class="c1"># if not, you can use sthg in the flavor of</span>
<span class="c1"># ls loc_*patentxx.tbd.txt_00* | parallel --eta &#39;mv {} {}_tmp &amp;&amp; echo &quot;recId|searchText&quot; &gt;&gt; {} &amp;&amp; cat {}_tmp &gt;&gt; {}&#39;</span>
<span class="nv">APIKEY</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">FILE</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="c1"># e.g. loc_ddpatentxx.tbd.txt_00</span>
<span class="nv">CNTFOCUS</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="c1"># e.g. deu</span>

<span class="nb">echo</span> <span class="s2">&quot;FILE: </span><span class="si">${</span><span class="nv">FILE</span><span class="si">}</span><span class="s2"> CNTFOCUS: </span><span class="si">${</span><span class="nv">CNTFOCUS</span><span class="si">}</span><span class="s2">&quot;</span>

patentcity geo here.post <span class="si">${</span><span class="nv">FILE</span><span class="si">}</span> <span class="si">${</span><span class="nv">APIKEY</span><span class="si">}</span> <span class="si">${</span><span class="nv">CNTFOCUS</span><span class="si">}</span>
<span class="c1"># print REQUESTID to stdout</span>

<span class="c1"># monitor status</span>
<span class="nv">REQUESTID</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
patentcity geo here.status <span class="nv">$REQUESTID</span> <span class="nv">$APIKEY</span>

<span class="c1"># get data and rename</span>
<span class="nv">OUTPUTDIR</span><span class="o">=</span><span class="s2">&quot;tmp&quot;</span>
mkdir -p <span class="si">${</span><span class="nv">OUTPUTDIR</span><span class="si">}</span>
patentcity geo here.get <span class="si">${</span><span class="nv">REQUESTID</span><span class="si">}</span> <span class="si">${</span><span class="nv">APIKEY</span><span class="si">}</span> --output-dir <span class="si">${</span><span class="nv">OUTPUTDIR</span><span class="si">}</span> <span class="o">&amp;&amp;</span> <span class="nv">RESULT</span><span class="o">=</span><span class="k">$(</span>ls <span class="si">${</span><span class="nv">OUTPUTDIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">REQUESTID</span><span class="si">}</span><span class="k">)</span> <span class="o">&amp;&amp;</span> mv <span class="si">${</span><span class="nv">OUTPUTDIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">REQUESTID</span><span class="si">}</span>/<span class="nv">$RESULT</span> ./<span class="s2">&quot;</span><span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">FILE</span><span class="si">}</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/tbd/here/g; s/txt/csv/g; s/loc/geoc/g&#39;</span><span class="k">)</span><span class="s2">&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;Saved as </span><span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">FILE</span><span class="si">}</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/tbd/here/g; s/txt/csv/g; s/loc/geoc/g&#39;</span><span class="k">)</span><span class="s2">!&quot;</span>
</code></pre></div>
</div>
<input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><label for="__tabbed_3_2">GMAPS</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="c1"># Geocode using GMAPS</span>
<span class="c1"># 1-by-1</span>
<span class="nv">APIKEY</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">OFFICE</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># see above</span>
<span class="nv">REGION</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># see above (nb uk for gb)</span>
<span class="nv">ROUND</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># e.g. 00</span>
<span class="nb">echo</span> <span class="s2">&quot;OFFICE:</span><span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span><span class="s2"> REGION:</span><span class="si">${</span><span class="nv">REGION</span><span class="si">}</span><span class="s2"> ROUND:</span><span class="si">${</span><span class="nv">ROUND</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;loc_</span><span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span><span class="s2">patentxx.here.nomatch.txt_</span><span class="si">${</span><span class="nv">ROUND</span><span class="si">}</span><span class="s2"> has </span><span class="k">$(</span>wc -l loc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.here.nomatch.txt_<span class="si">${</span><span class="nv">ROUND</span><span class="si">}</span><span class="k">)</span><span class="s2"> line(s)&quot;</span>
<span class="c1"># better safe than sorry</span>
patentcity geo gmaps.get loc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.here.nomatch.txt_<span class="si">${</span><span class="nv">ROUND</span><span class="si">}</span> <span class="si">${</span><span class="nv">APIKEY</span><span class="si">}</span> <span class="si">${</span><span class="nv">REGION</span><span class="si">}</span> &gt;&gt; geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.gmaps.txt_<span class="si">${</span><span class="nv">ROUND</span><span class="si">}</span>
</code></pre></div>
</div>
<input id="__tabbed_3_3" name="__tabbed_3" type="radio" /><label for="__tabbed_3_3">Manual annotations</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="c1"># Generate manual annotations using Prodigy</span>
XX

<span class="c1"># Generate manual annotations for country codes</span>
<span class="nv">FORMAT</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># e.g. ddpatentxx</span>
patentcity utils disamb-countrycodes loc_<span class="si">${</span><span class="nv">FORMAT</span><span class="si">}</span>.txt &gt;&gt; lib/loc_<span class="si">${</span><span class="nv">FORMAT</span><span class="si">}</span>.disamb.txt

<span class="c1"># Add manual geoc</span>
<span class="nv">FORMAT</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># e.g. frpatentxx, ddpatentxx</span>
<span class="nv">DISAMBFILE</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># e.g. lib/loc_${FORMAT}.disamb.txt</span>
<span class="nv">GEOCINDEX</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># e.g. lib/geoc_${FORMAT}.disamb.index.txt lib/geoc_iso.disamb.index.txt</span>
<span class="nv">FLAVOR</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># HERE or GMAPS</span>
patentcity geo add.disamb <span class="si">${</span><span class="nv">DISAMBFILE</span><span class="si">}</span> <span class="si">${</span><span class="nv">GEOCINDEX</span><span class="si">}</span> --flavor <span class="si">${</span><span class="nv">FLAVOR</span><span class="si">}</span>&gt;&gt; geoc_<span class="si">${</span><span class="nv">FORMAT</span><span class="si">}</span>.manual.txt
<span class="c1"># DISAMBFILE is a list of disambiguated loc together with their *original* hash (sep by the standard inDelim)</span>
<span class="c1"># GEOCINDEX is the list of geoc of disambigated loc (e.g. &quot;république fédérale d&#39;allemagne&quot;)</span>
<span class="c1"># FLAVOR is HERE or GMAPS depending on the flavor of GEOCINDEX</span>
<span class="c1"># The output is a GMAPS like file (md5|{})</span>
</code></pre></div>
</div>
</div>
<h2 id="add-geocoded-data">Add geocoded data<a class="headerlink" href="#add-geocoded-data" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Harmonize GMAPS and MANUAL as HERE geocoded data</span>
ls geoc_*patentxx.gmaps.txt.gz <span class="p">|</span> cut -d. -f1,2 <span class="p">|</span>parallel --eta <span class="s1">&#39;patentcity geo gmaps.harmonize {}.txt.gz --out-format csv &gt;&gt; {}.csv &amp;&amp; gzip {}.csv&#39;</span>
<span class="nv">MANUALDISAMB</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span>
<span class="k">for</span> OFFICE in <span class="si">${</span><span class="nv">MANUALDISAMB</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span>
  patentcity geo gmaps.harmonize geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.manual.txt --out-format csv &gt;&gt; geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.manual.csv<span class="p">;</span>
<span class="k">done</span><span class="p">;</span>

<span class="c1"># Stack geocoded data</span>
<span class="k">for</span> SERVICE in here gmaps<span class="p">;</span> <span class="k">do</span>
  <span class="k">for</span> OFFICE in dd de fr gb us<span class="p">;</span> <span class="k">do</span>
    rm -f geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.<span class="si">${</span><span class="nv">SERVICE</span><span class="si">}</span>.csv_xx
    head -n <span class="m">1</span> geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.<span class="si">${</span><span class="nv">SERVICE</span><span class="si">}</span>.csv_00 &gt;&gt; geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.<span class="si">${</span><span class="nv">SERVICE</span><span class="si">}</span>.csv_xx <span class="o">&amp;&amp;</span>
    <span class="k">for</span> i in <span class="m">0</span> <span class="m">1</span><span class="p">;</span> <span class="k">do</span>  <span class="c1"># up until last round</span>
      tail -n +2 geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.<span class="si">${</span><span class="nv">SERVICE</span><span class="si">}</span>.csv_0<span class="si">${</span><span class="nv">i</span><span class="si">}</span> &gt;&gt; geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.<span class="si">${</span><span class="nv">SERVICE</span><span class="si">}</span>.csv_xx<span class="p">;</span>
    <span class="k">done</span><span class="p">;</span>
  <span class="k">done</span><span class="p">;</span>
<span class="k">done</span><span class="p">;</span>

<span class="c1"># Incorporate geocoded data</span>
<span class="c1"># HERE and GMAPS</span>
<span class="k">for</span> OFFICE in dd de fr gb us<span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> <span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>
  patentcity geo add entrel_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.jsonl geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.here.csv_xx.gz --source HERE &gt;&gt; entrelgeoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.jsonl_tmp <span class="o">&amp;&amp;</span>
  patentcity geo add entrelgeoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.jsonl_tmp geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.gmaps.csv_xx.gz --source GMAPS &gt;&gt; entrelgeoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.jsonl <span class="o">&amp;&amp;</span>
  rm entrelgeoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.jsonl_tmp<span class="p">;</span>
<span class="k">done</span><span class="p">;</span>

<span class="nv">MANUALDISAMB</span><span class="o">=</span><span class="s2">&quot;dd fr&quot;</span>  <span class="c1"># we add dd which is already in HERE like format</span>
<span class="k">for</span> OFFICE in <span class="si">${</span><span class="nv">MANUALDISAMB</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span>
  mv entrelgeoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.jsonl entrelgeoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.jsonl_tmp <span class="o">&amp;&amp;</span>
  patentcity geo add entrelgeoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.jsonl_tmp geoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.manual.csv.gz --source MANUAL &gt;&gt; entrelgeoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.jsonl <span class="o">&amp;&amp;</span>
  rm entrelgeoc_<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>patentxx.jsonl_tmp<span class="p">;</span>
<span class="k">done</span><span class="p">;</span>

<span class="c1"># prep var name</span>
ls entrelgeoc_*patentxx.jsonl <span class="p">|</span> parallel --eta <span class="s2">&quot;&quot;&quot;mv {} {}_tmp &amp;&amp; sed &#39;s/\&quot;seqNumber\&quot;:/\&quot;loc_seqNumber\&quot;:/g; s/\&quot;seqLength\&quot;:/\&quot;loc_seqLength\&quot;:/g; s/\&quot;latitude\&quot;:/\&quot;loc_latitude\&quot;:/g; s/\&quot;longitude\&quot;:/\&quot;loc_longitude\&quot;:/g; s/\&quot;locationLabel\&quot;:/\&quot;loc_locationLabel\&quot;:/g; s/\&quot;addressLines\&quot;:/\&quot;loc_addressLines\&quot;:/g; s/\&quot;street\&quot;:/\&quot;loc_street\&quot;:/g; s/\&quot;houseNumber\&quot;:/\&quot;loc_houseNumber\&quot;:/g; s/\&quot;building\&quot;:/\&quot;loc_building\&quot;:/g; s/\&quot;subdistrict\&quot;:/\&quot;loc_subdistrict\&quot;:/g; s/\&quot;district\&quot;:/\&quot;loc_district\&quot;:/g; s/\&quot;city\&quot;:/\&quot;loc_city\&quot;:/g; s/\&quot;postalCode\&quot;:/\&quot;loc_postalCode\&quot;:/g; s/\&quot;county\&quot;:/\&quot;loc_county\&quot;:/g; s/\&quot;state\&quot;:/\&quot;loc_state\&quot;:/g; s/\&quot;country\&quot;:/\&quot;loc_country\&quot;:/g; s/\&quot;relevance\&quot;:/\&quot;loc_relevance\&quot;:/g; s/\&quot;matchType\&quot;:/\&quot;loc_matchType\&quot;:/g; s/\&quot;matchCode\&quot;:/\&quot;loc_matchCode\&quot;:/g; s/\&quot;matchLevel\&quot;:/\&quot;loc_matchLevel\&quot;:/g; s/\&quot;matchQualityStreet\&quot;:/\&quot;loc_matchQualityStreet\&quot;:/g; s/\&quot;matchQualityHouseNumber\&quot;:/\&quot;loc_matchQualityHouseNumber\&quot;:/g; s/\&quot;matchQualityBuilding\&quot;:/\&quot;loc_matchQualityBuilding\&quot;:/g; s/\&quot;matchQualityDistrict\&quot;:/\&quot;loc_matchQualityDistrict\&quot;:/g; s/\&quot;matchQualityCity\&quot;:/\&quot;loc_matchQualityCity\&quot;:/g; s/\&quot;matchQualityPostalCode\&quot;:/\&quot;loc_matchQualityPostalCode\&quot;:/g; s/\&quot;matchQualityCounty\&quot;:/\&quot;loc_matchQualityCounty\&quot;:/g; s/\&quot;matchQualityState\&quot;:/\&quot;loc_matchQualityState\&quot;:/g; s/\&quot;matchQualityCountry\\r\&quot;:/\&quot;loc_matchQualityCountry\&quot;:/g&#39; {}_tmp &gt;&gt; {} &quot;&quot;&quot;</span>
</code></pre></div>
<h2 id="build-data">Build data<a class="headerlink" href="#build-data" title="Permanent link">&para;</a></h2>
<div class="tabbed-set" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><label for="__tabbed_4_1">patentcity + wgp</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="nv">KEYFILE</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="c1"># &quot;credentials-patentcity.json&quot;</span>
<span class="nv">URIPC</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># &quot;gs://patentcity_dev/v1/entrelgeoc_*patentxx.jsonl&quot;</span>
<span class="nv">URIWGP</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># &quot;gs://gder_dev/v100rc4/patentcity*.jsonl.gz&quot;</span>
<span class="nv">STAGETABLE</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="c1">#e.g &quot;patentcity:tmp.v100rc5&quot;</span>
<span class="nv">RELEASETABLE</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># &quot;patentcity:patentcity.v100rc5&quot;</span>

bq load --source_format NEWLINE_DELIMITED_JSON --replace --ignore_unknown_values --max_bad_records <span class="m">10000</span> <span class="si">${</span><span class="nv">STAGETABLE</span><span class="si">}</span> <span class="si">${</span><span class="nv">URIPC</span><span class="si">}</span> schema/patentcity_v1.sm.json
bq load --source_format NEWLINE_DELIMITED_JSON --noreplace --ignore_unknown_values --max_bad_records <span class="m">1000</span> <span class="si">${</span><span class="nv">STAGETABLE</span><span class="si">}</span> <span class="si">${</span><span class="nv">URIWGP</span><span class="si">}</span> schema/patentcity_v1.sm.json

<span class="c1"># Augment data</span>
patentcity io augment-patentcity <span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">STAGETABLE</span><span class="si">}</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/:/./&#39;</span><span class="k">)</span> <span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">STAGETABLE</span><span class="si">}</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/:/./&#39;</span><span class="k">)</span> --key-file <span class="si">${</span><span class="nv">KEYFILE</span><span class="si">}</span>

<span class="c1"># Impute missing dates</span>
<span class="c1">#for OFFICE in dd de; do</span>
<span class="c1">#  patentcity utils expand-pubdate-imputation lib/pubdate_${OFFICE}patentxx.imputation.csv --output pubdate_${OFFICE}patentxx.imputation.expanded.csv;</span>
<span class="c1">#done;</span>
<span class="c1"># gsutil -m cp &quot;pubdate_*patentxx.imputation.expanded.csv&quot; gs://patentcity_dev/v1/</span>

<span class="k">for</span> OFFICE in dd de<span class="p">;</span> <span class="k">do</span>
  bq load --source_format CSV --replace --ignore_unknown_values --max_bad_records <span class="m">1000</span> patentcity:tmp.de_pubdate_imputation <span class="s2">&quot;gs://patentcity_dev/v1/pubdate_</span><span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span><span class="s2">patentxx.imputation.expanded.csv&quot;</span> schema/date_imputation.json
  patentcity io impute-publication-date <span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">STAGETABLE</span><span class="si">}</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/:/./&#39;</span><span class="k">)</span> patentcity.tmp.<span class="si">${</span><span class="nv">OFFICE</span><span class="si">}</span>_pubdate_imputation --country-code <span class="si">${</span><span class="nv">OFFICE</span><span class="p">:</span><span class="nv">u</span><span class="si">}</span> --key-file <span class="si">${</span><span class="nv">KEYFILE</span><span class="si">}</span><span class="p">;</span>
<span class="k">done</span><span class="p">;</span>


patentcity io family-expansion <span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">STAGETABLE</span><span class="si">}</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/:/./&#39;</span><span class="k">)</span> <span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">STAGETABLE</span><span class="si">}</span>_expansion <span class="p">|</span> sed -e <span class="s1">&#39;s/:/./&#39;</span><span class="k">)</span> <span class="nv">$KEYFILE</span> schema/patentcity_v1.json
gsutil -m rm <span class="s2">&quot;gs://tmp/family_expansion_*.jsonl.gz&quot;</span>
bq extract --destination_format NEWLINE_DELIMITED_JSON --compression GZIP <span class="si">${</span><span class="nv">STAGETABLE</span><span class="si">}</span>_expansion <span class="s2">&quot;gs://tmp/family_expansion_*.jsonl.gz&quot;</span>
bq load --source_format NEWLINE_DELIMITED_JSON --noreplace --ignore_unknown_values --max_bad_records <span class="m">1000</span> <span class="nv">$STAGETABLE</span> <span class="s2">&quot;gs://tmp/family_expansion_*.jsonl.gz&quot;</span>
patentcity io filter-kind-codes <span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">STAGETABLE</span><span class="si">}</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/:/./&#39;</span><span class="k">)</span> <span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">RELEASETABLE</span><span class="si">}</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/:/./&#39;</span><span class="k">)</span> <span class="nv">$KEYFILE</span>
</code></pre></div>
</div>
<input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><label for="__tabbed_4_2">patentcity only</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="c1">#STAGETABLE=&quot;patentcity:tmp.tmp&quot;</span>
<span class="nv">URI</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="c1"># e.g &quot;gs://patentcity_dev/v1/entrelgeoc_*patentxx.jsonl&quot;</span>
<span class="nv">RELEASETABLE</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="c1"># e.g. &quot;patentcity:patentcity.pc_v100rc5&quot;</span>
<span class="nv">KEYFILE</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="c1"># e.g. &quot;credentials-patentcity.json&quot;</span>
<span class="c1"># Load data</span>
bq load --source_format NEWLINE_DELIMITED_JSON --replace --ignore_unknown_values --max_bad_records <span class="m">10000</span> <span class="si">${</span><span class="nv">RELEASETABLE</span><span class="si">}</span> <span class="si">${</span><span class="nv">URI</span><span class="si">}</span> schema/patentcity_v1.sm.json
</code></pre></div>
</div>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../XX_DEDUPLICATION_EVALUATION/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Deduplication
            </div>
          </div>
        </a>
      
      
        <a href="../RECIPE_WGP/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              WGP
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://twitter.com/cyrilverluise" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.linkedin.com/in/cyril-verluise-80184347/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
    
  </body>
</html>